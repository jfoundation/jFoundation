(function(e,t,n,r){"use strict";Foundation.libs["magellan-expedition"]={name:"magellan-expedition",version:"5.1.0",settings:{active_class:"active",threshold:0,destination_threshold:20,throttle_delay:30},init:function(e,t,n){Foundation.inherit(this,"throttle");this.bindings(t,n)},events:function(){var n=this,r=n.S,i=n.settings;n.set_expedition_position();r(n.scope).off(".magellan").on("click.fndtn.magellan",'[data-magellan-arrival] a[href^="#"]',function(n){n.preventDefault();var r=e(this).closest("[data-magellan-expedition]"),i=r.data("magellan-expedition-init"),s=this.hash.split("#").join(""),o=e("a[name="+s+"]");o.length===0&&(o=e("#"+s));var u=o.offset().top;r.css("position")==="fixed"&&(u-=r.outerHeight());e("html, body").stop().animate({scrollTop:u},700,"swing",function(){t.location.hash="#"+s})}).on("scroll.fndtn.magellan",n.throttle(this.check_for_arrivals.bind(this),i.throttle_delay)).on("resize.fndtn.magellan",n.throttle(this.set_expedition_position.bind(this),i.throttle_delay))},check_for_arrivals:function(){var e=this;e.update_arrivals();e.update_expedition_positions()},set_expedition_position:function(){var t=this;e("["+this.attr_name()+"=fixed]",t.scope).each(function(n,r){var i=e(this),s=i.attr("styles"),o;i.attr("style","");o=i.offset().top;i.data(t.data_attr("magellan-top-offset"),o);i.attr("style",s)})},update_expedition_positions:function(){var n=this,r=e(t).scrollTop();e("["+this.attr_name()+"=fixed]",n.scope).each(function(){var t=e(this),n=t.data("magellan-top-offset");if(r>=n){var i=t.prev("[data-magellan-expedition-clone]");if(i.length===0){i=t.clone();i.removeAttr("data-magellan-expedition");i.attr("data-magellan-expedition-clone","");t.before(i)}t.css({position:"fixed",top:0})}else{t.prev("[data-magellan-expedition-clone]").remove();t.attr("style","")}})},update_arrivals:function(){var n=this,r=e(t).scrollTop();e("["+this.attr_name()+"]",n.scope).each(function(){var t=e(this),i=i=t.data(n.attr_name(!0)+"-init"),s=n.offsets(t,r),o=t.find("["+n.add_namespace("data-magellan-arrival")+"]"),u=!1;s.each(function(e,r){if(r.viewport_offset>=r.top_offset){var s=t.find("["+n.add_namespace("data-magellan-arrival")+"]");s.not(r.arrival).removeClass(i.active_class);r.arrival.addClass(i.active_class);u=!0;return!0}});u||o.removeClass(i.active_class)})},offsets:function(t,n){var r=this,i=t.data(r.attr_name(!0)+"-init"),s=n+i.destination_threshold;return t.find("["+r.add_namespace("data-magellan-arrival")+"]").map(function(t,n){var i=e(this).data(r.data_attr("magellan-arrival")),o=e("["+r.add_namespace("data-magellan-destination")+"="+i+"]");if(o.length>0){var u=o.offset().top;return{destination:o,arrival:e(this),top_offset:u,viewport_offset:s}}}).sort(function(e,t){return e.top_offset<t.top_offset?-1:e.top_offset>t.top_offset?1:0})},data_attr:function(e){return this.namespace.length>0?this.namespace+"-"+e:e},off:function(){this.S(this.scope).off(".magellan");this.S(t).off(".magellan")},reflow:function(){var t=this;e("[data-magellan-expedition-clone]",t.scope).remove()}}})(jQuery,this,this.document);